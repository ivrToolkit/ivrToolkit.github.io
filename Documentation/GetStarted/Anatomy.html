---
layout: docs
title: ScriptBlocks
---
<script type="text/javascript">
        var intro = $("#anatomy");
        intro.addClass("active");
        var parentDiv = intro.closest("div");
        parentDiv.addClass("show")
</script>


<div class="bd-toc mt-4 mb-5 my-md-0 ps-xl-3 mb-lg-5 text-muted">
    <strong class="d-block h6 my-2 pb-2 border-bottom">On this page</strong>
    <nav id="TableOfContents">
        <ul>
            <li><a href="#pluginManager">Plugin Manager</a></li>
            <li><a href="#scriptBlocks">Script Blocks</a></li>
            <li><a href="#scriptFlow">Script flow</a></li>
            <li><a href="#getLine">Geting a Line</a></li>
        </ul>
    </nav>
</div>



<div class="bd-intro ps-lg-4">
    <h1 class="bd-title" id="content">Anatomy</h1>
    <p>
        The building blocks of an ivrToolkit application
    </p>




    <h2 id="pluginManager">Plugin Manager<a class="anchorjs-link " aria-label="Anchor"
        data-anchorjs-icon="#" href="#pluginManager" style="padding-left: 0.375em;"></a></h2>
        <p>
            The Plugin Manager manages your collection of phone lines for the selected plugin.
        </p>    
    
    <div class="bd-clipboard"><button type="button" class="btn-clipboard" title=""
        data-bs-original-title="Copy to clipboard">Copy</button></div>
    <div class="highlight">
<pre><code class="language-csharp">// set up your configuration
var sipVoiceProperties = new SipVoiceProperties(_loggerFactory, @"c:\somewhere\voice.properties");

// create an instance of the plugin you want to use. In this case I chose SipSorcery
var sipPlugin = new SipSorceryPlugin(_loggerFactory, sipVoiceProperties);

// instantiate your plugin manager
var pluginManager = new PluginManager(_loggerFactory, sipPlugin);
</code></pre>
    </div>





    <h2 id="scriptBlocks">Script Blocks<a class="anchorjs-link " aria-label="Anchor"
        data-anchorjs-icon="#" href="#scriptBlocks" style="padding-left: 0.375em;"></a></h2>
        <p>
            A script block is an abstract class that you extend to do a block of work. 
            For example:
            WelcomeScript, MainMenuScript, SubMenu1Script, DoSomeJobScript etc.
        </p>

        <p>
            Here is an empty script block example. I've highlighted the important parts of the
            AbstractScript
        </p>
    
    
    <div class="bd-clipboard"><button type="button" class="btn-clipboard" title=""
        data-bs-original-title="Copy to clipboard">Copy</button></div>
    <div class="highlight">
<pre><code class="language-csharp">public class TestScript : AbstractScript
{
    private readonly ILoggerFactory _loggerFactory;
    private readonly VoiceProperties _voiceProperties;
    private readonly IIvrLine _line;
    private readonly ILogger _logger;

    public TestScript(ILoggerFactory loggerFactory,
            VoiceProperties voiceProperties,
            IIvrLine line)
            : base(loggerFactory, voiceProperties, line)
    {
        _loggerFactory = loggerFactory;
        _logger = loggerFactory.CreateLogger<MainScript>();
        _logger.LogDebug("Ctr()");
        _voiceProperties = voiceProperties;
        _line = line;
    }

    public override string Description => "Main Script";

    public override IScript Execute()
    {
        _logger.LogDebug("Execute()");

        // do work here

        // go to the next script you want to execute
        return new AnyScript(_loggerFactory, _voiceProperties, _line);

        // alternatively, if you want to end
        // return null;
    }
}
</code></pre>
    </div>






    <h2 id="scriptFlow">Script Flow<a class="anchorjs-link " aria-label="Anchor"
        data-anchorjs-icon="#" href="#scriptFlow" style="padding-left: 0.375em;"></a></h2>
    <p>
        The ScriptManager class defines the flow of your call.
    </p>
    <p>
        Instantiate the ScriptManager and pass in the first script you want to execute.
        The instantiation of the ScriptManager will queue up the first script.
        The while loop will execute the next script block and it is the responsibility
        of each script block to return the next script block to execute or null to exit
        the while loop.    
    </p>
    
    
    <div class="bd-clipboard"><button type="button" class="btn-clipboard" title=""
        data-bs-original-title="Copy to clipboard">Copy</button></div>
    <div class="highlight">
<pre><code class="language-csharp">var startScript = new WelcomeScript(_loggerFactory, _voiceProperties, _line);
var manager = new ScriptManager(_loggerFactory, startScript);

while (manager.HasNext())
{
    // execute the next script
    manager.Execute();
}

_logger.LogDebug("scripts are done so hanging up.");
_line.Hangup();
</code></pre>
    </div>
    




    <h2 id="getLine">Getting a Line<a class="anchorjs-link " aria-label="Anchor"
        data-anchorjs-icon="#" href="#getLine" style="padding-left: 0.375em;"></a></h2>
    <p>
        paragraph one
    </p>
    <p>
		paragraph two
    </p>
    
    <div class="bd-clipboard"><button type="button" class="btn-clipboard" title=""
        data-bs-original-title="Copy to clipboard">Copy</button></div>

    <div class="highlight">
<pre><code class="language-csharp">    var lineNumber = 1;
    var line = pluginManager.GetLine(lineNumber);
</code></pre>
    </div>







 



</div>






